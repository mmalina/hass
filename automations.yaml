- alias: TV turned on
  id: tv_turned_on
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: switch.hdmi_4
    to: 'on'
  action:
  - service: media_player.turn_on
    entity_id: media_player.yamaha_main
  - service: media_player.select_source
    data:
      entity_id: media_player.yamaha_main
      source: optical
- alias: TV turned off
  id: tv_turned_off
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: switch.hdmi_4
    to: 'off'
  action:
  - service: media_player.select_source
    data:
      entity_id: media_player.yamaha_main
      source: spotify
- alias: Weekly full snapshot
  id: weekly_full_snapshot
  trigger:
  - platform: time
    at: '3:00:00'
  condition:
  - condition: time
    weekday:
    - mon
  action:
  - service: hassio.snapshot_full
    data_template:
      name: Automated full backup {{ now().strftime('%Y-%m-%d') }}
  - delay:
      minutes: 10
  - service: hassio.addon_stdin
    data:
      addon: 7be23ff5_dropbox_sync
      input:
        command: upload
- alias: Lights on in the evening
  id: lights_on_in_the_evening
  trigger:
  - platform: sun
    event: sunset
    offset: -00:10:00
  condition:
  - condition: state
    entity_id: person.martin
    state: home
  action:
  - service: light.turn_on
    data:
      entity_id: light.center
      transition: 1200
      brightness: 128
  - service: light.turn_on
    data:
      entity_id: light.kitchen_table
      transition: 1200
      brightness: 178
  - service: light.turn_on
    data:
      entity_id: light.bar
      transition: 1200
      brightness: 178
  - service: light.turn_on
    data:
      entity_id: light.kitchen_desk
      transition: 1200
      brightness: 178

# - id: ikea_controller_volume_down
#   alias: Ikea Controller Volume Down
#   trigger:
#   - platform: mqtt
#     topic: zigbee2mqtt/ikea_controller
#   condition:
#   - condition: template
#     value_template: "{{ (trigger.payload|from_json).action == 'rotate_left' }}"
#   action:
#   # - entity_id: media_player.yamaha_main
#   #   service: media_player.turn_on
#   # - service: notify.notify
#   #   data_template:
#   #     message: >- # '{{ (trigger.payload|from_json).action }}'
#   #       {{ state_attr('media_player.yamaha_main', 'volume_level') - 0.02 }}
#   - service: media_player.volume_set
#     entity_id: media_player.yamaha_main
#     data_template:
#       volume_level: "{{ state_attr('media_player.yamaha_main', 'volume_level') - 0.02 }}"

# - id: ikea_controller_volume_up
#   alias: Ikea Controller Volume Up
#   trigger:
#   - platform: mqtt
#     topic: zigbee2mqtt/ikea_controller
#   condition:
#   - condition: template
#     value_template: "{{ (trigger.payload|from_json).action == 'rotate_right' }}"
#   action:
#   - service: media_player.volume_set
#     entity_id: media_player.yamaha_main
#     data_template:
#       volume_level: "{{ state_attr('media_player.yamaha_main', 'volume_level') + 0.02 }}"

- id: lights_off
  alias: Lights off
  trigger:
  - platform: state
    entity_id: person.martin
    to: not_home
  - platform: time
    at: '4:00:00'
  action:
  - service: light.turn_off
    entity_id: all
